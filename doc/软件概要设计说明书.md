# 软件概要设计说明书

>1. 《软件概要设计说明书》(SDD)概要设计说明书又可称系统设计说明书，这里所说的系统是指程序系统。编制的目的是说明对程序 系统的设计考虑，包括程序系统的基本处理流程、程序系统的组织结构、模块划分、功能分配、接口设计、运行设计、安全设计、数据结构设计和出错处理设计等，为程序的详细设计提供基础。
>2. 本课程及本实验不涉及、不强调、不关注的部分可省略，但不允许删除已有条目。
>3. 最终文档请删除所有灰色字体和斜体等说明部分。

[Toc]

## 1 引言

### 1.1 编写目的

*说明编写这份概要设计说明书的目的，指出预期的读者。*

### 1.2 背景

*说明：*

*a．待开发软件系统的名称；*

*b．列出此项目的任务提出者、开发者、用户以及将运行该软件的计算站（中心）。*

### 1.3 定义

*列出本文件中用到的专门术语的定义和外文首字母组词的原词组。*

### 1.4参考设计

*列出有关的参考文件*

## 2 系统需求概述

### 2.1需求规定

*说明对本系统的主要的输入输出项目、处理的功能性能要求*

### 2.2业务目标

### 2.3运行环境

*简要地说明对本系统的运行环境（包括硬件环境和支持环境）的规定*

#### 2.3.1设备 

*列出运行该软件所需要的硬设备。说明其中的新型设备及其专门功能。*

#### 2.3.2支持软件

*列出支持软件，包括要用到的操作系统、编译（或汇编）程序、测试支持软件等。*

### 2.4设计约束

### 2.5功能需求

*说明本系统的基本设计概念和处理流程，尽量使用图表的形式。*

### 2.6非功能需求

### 2.7系统总体架构

*用UML图和相应的文字介绍说明本系统的整体架构*

## 3 系统接口设计

### 3.2接口设计

#### 3.2.1用户接口

*说明将向用户提供的命令和它们的语法结构，以及软件的回答信息。*

*说明提供给用户操作的硬件控制面板的定义。*

#### 3.2.2 与其他软件、硬件接口

*说明本系统同外界的所有接口的安排包括软件与硬件之间的接口、本系统与各支持软件之间的接口关系以及各个系统元素之间的接口的安排。*

### 3.3 系统数据结构设计

#### 3.3.1 逻辑结构设计要点

1. 用户数据结构

   * 名称：用户信息表
   * 标识符：**Users**
   * 数据项
     * 用户 ID（ID）：系统自动生成的唯一标识，用于识别每个用户。定义为 16 位整数类型，是用户信息表的主键，在其他与用户相关的表中作为外键关联，以建立用户与订单、消息等数据的关系。
     * 用户名（username）：用户注册时设定的名称，用于登录和显示。定义为字符串类型，长度限制为 50 字符，确保用户名不为空以及不重复，保证了在用户登录或查找用户时能准确匹配。
     * 密码（password）：用户登录密码，经过加密存储。字符串类型，长度根据加密算法确定，一般加密后的长度在 256 字符之间，保障密码安全性。
     * 身份证号码（id_card）：该字段用于存储用户的身份证号码，VARCHAR(20) 足以容纳 18 位的身份证号码及可能的其他相关字符。NOT NULL 保证了每个用户都必须提供身份证号码。
     * 手机号（phone）：用户绑定的手机号码，用于接收消息通知。字符串类型，长度为 11 位，符合国内手机号码的格式规范，是消息通知模块发送短信的关键依据。
     * 邮箱（email）：该字段存储用户的电子邮件地址，VARCHAR(100) 能满足大多数电子邮件地址的长度需求。NOT NULL 要求用户必须提供电子邮件地址，UNIQUE 则保证了系统中每个邮箱地址都是唯一的，这在用户找回密码、接收通知等场景中非常重要。
     * 创建时间（create_at）：该字段记录用户的创建时间，TIMESTAMP 数据类型会存储日期和时间信息。DEFAULT CURRENT_TIMESTAMP 表示如果在插入记录时没有指定该字段的值，系统会自动使用当前的时间作为默认值。

   

2. 车次数据结构

   * 名称：城市信息表
   * 标识符：**City**
   * 数据项：
     * id：BINARY(16) 类型的主键，用于唯一标识每个城市。
     * city_name：VARCHAR(50) 类型，存储城市名称，不能为空
   * 名称：车站信息表
   * 标识符：**Station**
   * 数据项：
     * id：BINARY(16) 类型的主键，唯一标识每个车站。
     * station_name：VARCHAR(50) 类型，存储车站名称，不能为空。
     * city_id：BINARY(16) 类型，关联 City 表的 id，表示该车站所在的城市。

   

   * 名称：车次信息表
   * 标识符：**TrainNumbers**
   * 数据项：
     * id：BINARY(16) 类型的主键，唯一标识每个车次。
     * train_number：VARCHAR(10) 类型，存储车次编号，如 G5151。
     * dep_station 和 arr_station：VARCHAR(50) 类型，分别存储出发站和到达站的名称。
     * dep_city 和 arr_city：VARCHAR(50) 类型，分别存储出发城市和到达城市的名称。
     * dep_time 和 arr_time：DATETIME 类型，分别存储出发时间和到达时间。

   

   * 名称：车厢信息表
   * 标识符：**Carriages**
   * 数据项：
     * id：BINARY(16) 类型的主键，唯一标识每个车厢。
     * train_number：BINARY(16) 类型，关联车次的 id，表示该车厢所属的车次。
     * dep_station、dep_city、arr_station、arr_city、arr_time：与 TrainNumbers 表中的含义类似，存储车厢对应的出发站、出发城市、到达站、到达城市和到达时间。
     * wait_time：TIME 类型，存储等候时间。
     * all_number、first_number、second_number、business_number、no_seat_number：INT(10) 类型，分别存储车厢的总座位数、一等座数量、二等座数量、商务座数量和无座数量。

   

   * 名称：座位信息表
   * 标识符：**Seats**
   * 数据项：
     * id：BINARY(16) 类型的主键，唯一标识每个座位。
     * train_number：BINARY(16) 类型，关联车次的 id，表示该座位所属的车次。
     * coach：INT(10) 类型，存储车厢号。
     * seat_type：VARCHAR(10) 类型，存储座位类型，如一等座、二等座等。
     * price：DECIMAL(10, 2) 类型，存储座位价格。
     * flags：BINARY(8) 类型，用于存储座位状态。

   

   * 名称：食物信息表
   * 标识符：**Food**
   * 数据项：
     * id：BINARY(16) 类型的主键，唯一标识每种食物。
     * trains_id：BINARY(16) 类型，关联车次的 id，表示该食物所属的车次。
     * food_name：VARCHAR(50) 类型，存储食物名称。
     * food_type：VARCHAR(10) 类型，存储食物类型。
     * price：DECIMAL(10, 2) 类型，存储食物价格。
     * lunch 和 dinner：BOOLEAN 类型，分别表示该食物是否为午餐或晚餐，默认为 0。
     * pic_url：VARCHAR(255) 类型，存储食物的图片 URL。

   

3. 酒店数据结构

   * 名称：酒店信息表
   * 标识符：**Hotel**
   * 数据项：
     * id：BINARY(16) 类型的主键，用于唯一标识每个酒店。
     * name：VARCHAR(50) 类型，存储酒店名称，不能为空。
     * address：VARCHAR(50) 类型，存储酒店地址，不能为空。
     * rating：DECIMAL(2, 1) 类型，存储酒店的评分，保留一位小数。
     * description：VARCHAR(255) 类型，存储酒店的描述信息。
     * pic_url：VARCHAR(255) 类型，存储酒店的图片 URL。

   

   * 名称：酒店房间信息表
   * 标识符：**Room**
   * 数据项：
     * id：BINARY(16) 类型的主键，唯一标识每个房间。
     * hotel_id：BINARY(16) 类型，外键关联 Hotel 表的 id，表示该房间所属的酒店。
     * room_type：VARCHAR(50) 类型，存储房间类型，如标准间、豪华套房等。
     * price：DECIMAL(10, 2) 类型，存储房间的价格。
     * room_date：DATE 类型，存储房间的日期信息，可能用于表示该日期房间的状态。
     * availability：BOOLEAN 类型，默认值为 TRUE，表示房间是否可用。

   

   * 名称：用户预订信息表

   * 标识符：**Reservation**

   * 数据项：

     * id：BINARY(16) 类型的主键，唯一标识每个预订记录。
     * user_id：BINARY(16) 类型，可能关联用户表的 id，表示进行预订的用户。
     * hotel_id：BINARY(16) 类型，外键关联 Hotel 表的 id，表示预订的酒店。
     * room_id：BINARY(16) 类型，外键关联 Room 表的 id，表示预订的房间。
     * checkin_date：DATE 类型，存储入住日期。
     * checkout_date：DATE 类型，存储退房日期。
     * status：VARCHAR(50) 类型，默认值为 'Booked'，表示预订的状态，如已预订、已取消等。
     * booking_time：TIMESTAMP 类型，默认值为当前时间，记录预订的时间。

     

4. 订单数据结构

   * 名称：支付信息记录表
   * 标识符：**payment_records**
   * 数据项：
     * payment_id：BINARY(16) 类型的主键，唯一标识每笔支付记录。
     * order_id：BINARY(16) 类型，关联相应的订单，确保支付与订单的对应关系。
     * user_id：BINARY(16) 类型，标识支付的用户。
     * pay_type：VARCHAR(20) 类型，记录购买对象的类型，如车票、酒店等。
     * amount：DECIMAL(10, 2) 类型，记录支付金额，保留两位小数。
     * method：VARCHAR(20) 类型，记录支付方式，如微信支付、支付宝支付等。
     * status：VARCHAR(20) 类型，默认值为 '待支付'，记录支付状态。
     * created_time：DATETIME 类型，默认值为当前时间，记录发起支付的时间。
     * updated_time：DATETIME 类型，默认值为当前时间，且在记录更新时自动更新，记录最后更新时间。

   

   * 名称：车票订单信息记录表
   * 标识符：**tickets_orders**
   * 数据项：
     * id：BINARY(16) 类型的主键，唯一标识每张车票订单。
     * pay_id：BINARY(16) 类型，关联支付记录的 payment_id。
     * user_id：BINARY(16) 类型，标识下单的用户。
     * contacts_id：BINARY(16) 类型，关联联系人信息（虽然未给出 contacts 表，但推测可能用于存储乘车人信息）。
     * train_id：BINARY(16) 类型，关联车次信息，记录订单对应的车次。
     * seat_id：BINARY(16) 类型，关联座位信息，记录订单对应的座位。

   

   * 名称：酒店订单信息记录表

   * 标识符：**hotel_orders**

   * 数据项：

     * id：BINARY(16) 类型的主键，唯一标识每个酒店订单。
     * pay_id：BINARY(16) 类型，关联支付记录的 payment_id。
     * user_id：BINARY(16) 类型，标识下单的用户。
     * reservation_id：BINARY(16) 类型，关联酒店预订记录，记录订单对应的酒店预订。

     

   * 名称：食物订单信息记录表

   * 标识符：**food_orders**

   * 数据项：

     * id：BINARY(16) 类型的主键，唯一标识每个食物订单。
     * pay_id：BINARY(16) 类型，关联支付记录的 payment_id。
     * user_id：BINARY(16) 类型，标识下单的用户。

     

5. 消息数据结构

   * 名称：消息记录表
   * 标识符：**nofications**
   * 数据项：
     * message_id：BINARY(16) 类型的主键，自增，唯一标识每条消息。
     * user_id：BINARY(16) 类型，标识接收消息的用户。
     * order_id：BINARY(16) 类型，可关联订单，部分消息可能与订单相关。
     * message_type：VARCHAR(20) 类型，记录消息的类型，如订单通知、系统公告等。
     * content：TEXT 类型，存储消息的具体内容。
     * channel：VARCHAR(20) 类 型，默认值为 '站内信'，记录消息的发送渠道。
       ' 站内信 '`，记录消息的发送渠道。
     * is_read：BOOLEAN 类型，默认值为 FALSE，记录用户是否已读该消息。
     * send_status：VARCHAR(20) 类型，默认值为 '待发送'，记录消息的发送状态。
     * send_time：DATETIME 类型，记录消息的发送时间。
     * created_time：DATETIME 类型，默认值为当前时间，记录消息的创建时间。



#### 3.3.2 物理结构设计要点

##### 1. 用户信息表（Users）

1. 存储要求
   - **用户 ID（ID）**：16 位整数类型，存储为固定长度，确保唯一性和快速查找。
   - **用户名（username）**：VARCHAR (50)，以变长字符串存储，节省空间，最大长度为 50 字符。
   - **密码（password）**：字符串类型，长度根据加密算法确定，一般加密后的长度在 256 字符之间，存储为固定长度或变长字符串，取决于加密算法的输出。
   - **身份证号码（id_card）**：VARCHAR (20)，存储为变长字符串，最大长度 20 字符。
   - **手机号（phone）**：字符串类型，长度 11 位，存储为固定长度，方便快速比对。
   - **邮箱（email）**：VARCHAR (100)，以变长字符串存储，最大长度 100 字符。
   - **创建时间（create_at）**：TIMESTAMP 类型，存储日期和时间信息，占用固定字节数。
2. 访问方法
   - 通过用户 ID 进行快速定位，用于获取用户详细信息。
   - 根据用户名和密码进行联合查询，用于用户登录验证。
   - 利用邮箱进行查找，用于找回密码或发送通知等操作。
3. 存取单位：以记录为存取单位，每次操作针对一条用户记录。
4. 存取的物理关系
   - **索引**：对用户 ID 建立主键索引，对用户名、邮箱建立唯一索引，提高查找效率。
   - **设备**：存储在数据库服务器的磁盘上，使用高速磁盘设备（如 SSD）提高读写性能。
   - **存储区域**：划分专门的用户数据存储区域，便于管理和维护。
5. 设计考虑
   - 为确保密码安全，采用强加密算法（如 bcrypt、argon2 等）对密码进行加密存储。
   - 对身份证号码、手机号进行格式验证，确保数据的准确性和有效性。
6. 保密条件：对密码、身份证号码等敏感信息进行加密存储，严格控制数据库访问权限，只有授权人员可以访问用户信息。



##### 2. 城市信息表（City）

1. 存储要求
   - **id**：BINARY (16)，存储为固定长度的 16 字节，确保唯一性。
   - **city_name**：VARCHAR (50)，以变长字符串存储，最大长度 50 字符。
2. 访问方法：通过城市 ID 进行快速查询，获取城市名称等信息；也可通过城市名称进行模糊查询。
3. 存取单位：以记录为存取单位。
4. 存取的物理关系
   - **索引**：对 id 建立主键索引，对 city_name 建立普通索引，方便按名称查询。
   - **设备**：存储在数据库服务器磁盘，建议使用高速存储设备。
   - **存储区域**：划分城市数据存储区域。
5. 设计考虑：确保城市名称的唯一性，避免重复数据。
6. 保密条件：城市信息一般不涉及敏感信息，但需保证数据的准确性和完整性，防止数据被非法篡改。



##### 3. 车站信息表（Station）

1. 存储要求
   - **id**：BINARY (16)，固定长度 16 字节。
   - **station_name**：VARCHAR (50)，变长字符串，最大长度 50 字符。
   - **city_id**：BINARY (16)，固定长度 16 字节。
2. 访问方法：通过车站 ID 获取详细信息；通过 city_id 查询特定城市下的所有车站。
3. 存取单位：以记录为单位存取。
4. 存取的物理关系
   - **索引**：id 为主键索引，city_id 建立普通索引，方便关联查询。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：与城市信息表存储区域关联，便于管理。
5. 设计考虑：确保 station_name 在所属城市内的唯一性，避免混淆。
6. 保密条件：车站信息通常不敏感，重点在于数据的一致性和准确性。



##### 4. 车次信息表（TrainNumbers）

1. 存储要求
   - **id**：BINARY (16)，16 字节固定长度。
   - **train_number**：VARCHAR (10)，变长字符串，最大长度 10 字符。
   - **dep_station、arr_station**：VARCHAR (50)，变长字符串，最大长度 50 字符。
   - **dep_city、arr_city**：VARCHAR (50)，变长字符串，最大长度 50 字符。
   - **dep_time、arr_time**：DATETIME，存储日期和时间，占用固定字节数。
2. 访问方法：通过车次 ID 快速定位车次；根据出发站、到达站、出发时间等条件组合查询车次。
3. 存取单位：以记录为存取单位。
4. 存取的物理关系
   - **索引**：id 建立主键索引，对常用查询字段（如 dep_station、arr_station、dep_time 等）建立复合索引，提高查询效率。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：单独划分车次数据存储区域。
5. 设计考虑：确保车次编号的唯一性，合理设计索引以优化查询性能。
6. 保密条件：车次信息不涉及敏感信息，重点保证数据的实时性和准确性。



##### 5. 车厢信息表（Carriages）

1. 存储要求
   - **id**：BINARY (16)，16 字节固定长度。
   - **train_number**：BINARY (16)，16 字节固定长度。
   - **dep_station、dep_city、arr_station、arr_city、arr_time**：同 TrainNumbers 表对应字段。
   - **wait_time**：TIME，存储时间信息，占用固定字节数。
   - **all_number、first_number、second_number、business_number、no_seat_number**：INT (10)，存储座位数量，占用固定字节数。
2. **访问方法**：通过车厢 ID 获取详细信息；通过 train_number 查询特定车次的所有车厢信息。
3. **存取单位**：以记录为存取单位。
4. 存取的物理关系
   - **索引**：id 建立主键索引，train_number 建立普通索引，方便关联查询。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：与车次信息表存储区域关联。
5. **设计考虑**：合理设计座位数量字段，便于管理和统计。
6. **保密条件**：车厢信息不敏感，确保数据的准确性和一致性。



##### 6. 座位信息表（Seats）

1. 存储要求
   - **id**：BINARY (16)，16 字节固定长度。
   - **train_number**：BINARY (16)，16 字节固定长度。
   - **coach**：INT (10)，存储车厢号，占用固定字节数。
   - **seat_type**：VARCHAR (10)，变长字符串，最大长度 10 字符。
   - **price**：DECIMAL (10, 2)，存储座位价格，占用固定字节数。
   - **flags**：BINARY (8)，8 字节固定长度，存储座位状态。
2. **访问方法**：通过座位 ID 获取信息；根据 train_number、coach 等条件查询特定车厢内的座位情况。
3. **存取单位**：以记录为存取单位。
4. 存取的物理关系
   - **索引**：id 建立主键索引，train_number、coach 建立复合索引，提高查询效率。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：与车厢信息表存储区域关联。
5. **设计考虑**：优化 flags 字段的存储方式，确保能准确表示座位状态。
6. **保密条件**：座位信息不敏感，重点在于数据的实时性和准确性。



##### 7. 食物信息表（Food）

1. 存储要求
   - **id**：BINARY (16)，16 字节固定长度。
   - **trains_id**：BINARY (16)，16 字节固定长度。
   - **food_name**：VARCHAR (50)，变长字符串，最大长度 50 字符。
   - **food_type**：VARCHAR (10)，变长字符串，最大长度 10 字符。
   - **price**：DECIMAL (10, 2)，固定字节数存储价格。
   - **lunch、dinner**：BOOLEAN，存储为 1 字节，分别表示是否为午餐或晚餐。
   - **pic_url**：VARCHAR (255)，变长字符串，最大长度 255 字符。
2. **访问方法**：通过食物 ID 获取详细信息；根据 trains_id 查询特定车次的食物信息。
3. **存取单位**：以记录为存取单位。
4. 存取的物理关系
   - **索引**：id 建立主键索引，trains_id 建立普通索引，方便关联查询。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：与车次信息表存储区域关联。
5. **设计考虑**：确保食物名称的唯一性，合理设计图片 URL 存储方式。
6. **保密条件**：食物信息不敏感，保证数据的准确性和完整性。



##### 8. 酒店信息表（Hotel）

1. 存储要求
   - **id**：BINARY (16)，16 字节固定长度。
   - **name**：VARCHAR (50)，变长字符串，最大长度 50 字符。
   - **address**：VARCHAR (50)，变长字符串，最大长度 50 字符。
   - **rating**：DECIMAL (2, 1)，存储评分，占用固定字节数。
   - **description**：VARCHAR (255)，变长字符串，最大长度 255 字符。
   - **pic_url**：VARCHAR (255)，变长字符串，最大长度 255 字符。
2. **访问方法**：通过酒店 ID 获取详细信息；根据酒店名称、地址等条件进行查询。
3. **存取单位**：以记录为存取单位。
4. 存取的物理关系
   - **索引**：id 建立主键索引，对常用查询字段（如 name、address）建立索引，提高查询效率。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：划分酒店数据存储区域。
5. **设计考虑**：合理设计评分字段，确保描述信息和图片 URL 的存储稳定性。
6. **保密条件**：酒店信息不敏感，重点保证数据的准确性和吸引力。



##### 9. 酒店房间信息表（Room）

1. 存储要求
   - **id**：BINARY (16)，16 字节固定长度。
   - **hotel_id**：BINARY (16)，16 字节固定长度。
   - **room_type**：VARCHAR (50)，变长字符串，最大长度 50 字符。
   - **price**：DECIMAL (10, 2)，固定字节数存储价格。
   - **room_date**：DATE，存储日期信息，占用固定字节数。
   - **availability**：BOOLEAN，存储为 1 字节，表示房间是否可用。
2. **访问方法**：通过房间 ID 获取详细信息；根据 hotel_id 查询特定酒店的房间情况。
3. **存取单位**：以记录为存取单位。
4. 存取的物理关系
   - **索引**：id 建立主键索引，hotel_id 建立普通索引，方便关联查询。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：与酒店信息表存储区域关联。
5. **设计考虑**：合理设计 room_date 和 availability 字段，确保能准确反映房间状态。
6. **保密条件**：房间信息不敏感，重点在于数据的实时性和准确性。



##### 10. 用户预订信息表（Reservation）

1. 存储要求
   - **id**：BINARY (16)，16 字节固定长度。
   - **user_id**：BINARY (16)，16 字节固定长度。
   - **hotel_id**：BINARY (16)，16 字节固定长度。
   - **room_id**：BINARY (16)，16 字节固定长度。
   - **checkin_date、checkout_date**：DATE，存储日期信息，占用固定字节数。
   - **status**：VARCHAR (50)，变长字符串，最大长度 50 字符。
   - **booking_time**：TIMESTAMP，存储日期和时间，占用固定字节数。
2. **访问方法**：通过预订 ID 获取详细信息；根据 user_id 查询用户的所有预订记录；根据 hotel_id、room_id 等条件查询特定酒店房间的预订情况。
3. **存取单位**：以记录为存取单位。
4. 存取的物理关系
   - **索引**：id 建立主键索引，对常用查询字段（如 user_id、hotel_id、room_id 等）建立索引，提高查询效率。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：与酒店和用户数据存储区域关联。
5. **设计考虑**：合理设计状态字段，确保预订时间和日期信息的准确性。
6. **保密条件**：预订信息涉及用户隐私，对敏感信息进行加密存储，严格控制访问权限。



##### 11. 支付信息记录表（payment_records）

1. 存储要求
   - **payment_id**：BINARY (16)，16 字节固定长度。
   - **order_id**：BINARY (16)，16 字节固定长度。
   - **user_id**：BINARY (16)，16 字节固定长度。
   - **pay_type**：VARCHAR (20)，变长字符串，最大长度 20 字符。
   - **amount**：DECIMAL (10, 2)，固定字节数存储金额。
   - **method**：VARCHAR (20)，变长字符串，最大长度 20 字符。
   - **status**：VARCHAR (20)，变长字符串，最大长度 20 字符。
   - **created_time、updated_time**：DATETIME，存储日期和时间，占用固定字节数。
2. **访问方法**：通过支付 ID 获取详细信息；根据 user_id 查询用户的支付记录；根据 order_id 查询订单的支付情况。
3. **存取单位**：以记录为存取单位。
4. 存取的物理关系
   - **索引**：payment_id 建立主键索引，对常用查询字段（如 user_id、order_id 等）建立索引，提高查询效率。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：划分支付数据存储区域。
5. **设计考虑**：合理设计时间字段，确保金额和状态信息的准确性。
6. **保密条件**：支付信息敏感，对金额、支付方式等信息进行加密存储，严格控制访问权限。



##### 12. 车票订单信息记录表（tickets_orders）

1. 存储要求
   - **id**：BINARY (16)，16 字节固定长度。
   - **pay_id**：BINARY (16)，16 字节固定长度。
   - **user_id**：BINARY (16)，16 字节固定长度。
   - **contacts_id**：BINARY (16)，16 字节固定长度。
   - **train_id**：BINARY (16)，16 字节固定长度。
   - **seat_id**：BINARY (16)，16 字节固定长度。
2. **访问方法**：通过订单 ID 获取详细信息；根据 user_id 查询用户的车票订单；根据 train_id、seat_id 等条件查询特定车次座位的订单情况。
3. **存取单位**：以记录为存取单位。
4. 存取的物理关系
   - **索引**：id 建立主键索引，对常用查询字段（如 user_id、train_id 等）建立索引，提高查询效率。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：与车次、座位和用户数据存储区域关联。
5. **设计考虑**：确保订单信息的完整性和准确性。
6. **保密条件**：车票订单涉及个人出行信息，对敏感信息加密存储，严格控制访问权限。



##### 13. 酒店订单信息记录表（hotel_orders）

1. 存储要求
   - **id**：BINARY (16)，16 字节固定长度。
   - **pay_id**：BINARY (16)，16 字节固定长度。
   - **user_id**：BINARY (16)，16 字节固定长度。
   - **reservation_id**：BINARY (16)，16 字节固定长度。
2. **访问方法**：通过订单 ID 获取详细信息；根据 user_id 查询用户的酒店订单；根据 reservation_id 查询特定预订的订单情况。
3. **存取单位**：以记录为存取单位。
4. 存取的物理关系
   - **索引**：id 建立主键索引，对常用查询字段（如 user_id、reservation_id 等）建立索引，提高查询效率。
   - **设备**：存储在数据库服务器磁盘。
   - **存储区域**：与酒店预订和用户数据存储区域关联。
5. **设计考虑**：确保订单与预订信息的准确关联。
6. **保密条件**：酒店订单涉及个人住宿信息，对敏感信息加密存储，严格控制访问权限。



##### 14. 食物订单信息记录表（food_orders）

1. 存储要求：
   * **id**：BINARY (16)，以固定长度的 16 字节进行存储，保证唯一性且便于快速查找。
   * **pay_id**：BINARY (16)，固定 16 字节存储，用于关联支付记录，建立订单与支付的联系。
   * **user_id**：BINARY (16)，同样以 16 字节固定长度存储，标识下单用户，方便按用户查询订单。
2. 访问方法：
   * 依据订单 ID 可精准定位特定的食物订单，获取订单详情。
   * 通过用户 ID 能查询该用户的所有食物订单记录，用于用户查看自己的消费情况。
   * 借助支付 ID 可关联支付记录，确认订单的支付状态。
3. 存取单位：以每条订单记录作为存取单位，对订单信息进行插入、查询、更新和删除操作。
4. 存取的物理关系：
   * 索引：对订单 ID 建立主键索引，保证查询的高效性；对用户 ID 和支付 ID 建立普通索引，加快关联查询速度。
   * 设备：存于数据库服务器的磁盘，建议使用高性能磁盘，如 SSD，以提升读写性能。
   * 存储区域：和支付记录、用户信息等相关数据存于同一存储区域，方便数据关联和管理。
5. 设计考虑：
   * 确保订单 ID 的唯一性，防止数据冲突。
   * 对用户 ID 和支付 ID 进行有效性检查，保证关联的准确性。
6. 保密条件：食物订单信息包含用户的消费行为，虽敏感程度相对较低，但仍需对用户 ID 等信息进行保护，限制对数据库的访问权限，避免数据泄露。



##### 15. 消息记录表（notifications）

1. 存储要求
   * **message_id**：BINARY (16)，自增且固定 16 字节存储，作为消息的唯一标识。
   * **user_id**：BINARY (16)，16 字节固定长度，明确消息的接收用户。
   * **order_id**：BINARY (16)，16 字节存储，用于关联相关订单，部分消息可能与订单状态有关。
   * **message_type**：VARCHAR (20)，以变长字符串形式存储，最大长度 20 字符，记录消息类型。
   * **content**：TEXT 类型，可存储大量文本信息，用于保存消息的具体内容。
   * **channel**：VARCHAR (20)，变长字符串，最大 20 字符，默认值为 ' 站内信 '，表示消息的发送渠道。
   * **is_read**：BOOLEAN 类型，占用 1 字节，记录用户是否已读消息。
   * **send_status**：VARCHAR (20)，变长字符串，最大 20 字符，默认值为 ' 待发送 '，表明消息的发送状态。
   * **send_time**：DATETIME 类型，存储消息的发送时间，占用固定字节数。
   * **created_time**：DATETIME 类型，默认值为当前时间，记录消息的创建时间。

2. 访问方法
   * 通过消息 ID 可快速获取特定消息的详细内容。
   * 根据用户 ID 查询该用户接收的所有消息，便于用户查看自己的消息列表。
   * 依据订单 ID 查找与特定订单相关的消息，跟踪订单状态变化通知。

3. 存取单位：以每条消息记录为存取单位，实现消息的创建、查询、标记已读等操作。

4. 存取的物理关系
   * 索引：对消息 ID 建立主键索引；对用户 ID、订单 ID 建立普通索引，提高查询效率。
   * 设备：存储在数据库服务器磁盘，使用高速磁盘保证消息的快速读写。
   * 存储区域：和用户信息、订单信息等相关数据存储在同一区域，方便数据关联和管理。

5. 设计考虑
   * 保证消息 ID 的唯一性，防止消息混淆。
   * 对消息类型、发送渠道、发送状态等字段进行合理的枚举或规范，便于管理和查询。

6. 保密条件：消息内容可能包含敏感信息，如订单详情、系统通知等，需要对消息内容进行加密存储，严格控制数据库访问权限，确保只有接收用户和授权人员可以查看消息。



#### 3.3.3 数据结构与程序关系

1. 用户信息表（Users）与程序的关系

   - **用户注册程序**：接收用户输入的用户名、密码、身份证号码、手机号、邮箱等信息，对数据进行合法性校验，如检查用户名是否重复、密码强度是否符合要求、身份证号码和手机号格式是否正确等。校验通过后，生成唯一的用户 ID，将数据插入到用户信息表中，同时记录当前时间作为创建时间。
   - **用户登录程序**：获取用户输入的用户名和密码，在用户信息表中查询匹配的记录。通过对查询结果中的密码进行解密（若采用加密存储）或直接对比（若存储的是哈希值），验证用户身份。若验证成功，根据用户 ID 获取用户的其他信息，用于后续的系统操作和个性化展示。
   - **用户信息修改程序**：用户在系统中修改个人信息时，程序根据用户 ID 定位到用户信息表中的对应记录，更新相应的字段，如用户名、手机号、邮箱等。修改密码时，先对新密码进行加密处理，再更新到表中。
   - **消息通知程序**：当系统有消息需要通知用户时，根据用户的手机号或邮箱从用户信息表获取接收渠道信息，结合消息记录表（notifications）中的消息内容，将消息发送给用户。例如，在用户订单状态发生变化时，发送通知消息。

   

2. 城市信息表（City）与程序的关系

   - **城市数据初始化程序**：在系统初始化或数据更新时，将城市数据插入到城市信息表中。程序从数据源（如外部数据文件、其他系统接口）读取城市名称和 ID 等信息，进行必要的数据清洗和格式转换后，插入到表中。
   - **车次信息查询程序**：在车次查询功能中，当用户输入出发城市和到达城市时，程序根据城市名称从城市信息表中获取对应的城市 ID，再利用这些 ID 在车次信息表（TrainNumbers）中进行查询，筛选出符合条件的车次，提高查询效率。
   - **车站信息关联程序**：在插入或更新车站信息时，程序会根据车站所在城市名称，从城市信息表获取城市 ID，确保车站信息表（Station）中的 city_id 字段与城市信息表的 ID 准确关联，维护数据的一致性。

   

3. 车站信息表（Station）与程序的关系

   - **车站数据维护程序**：用于插入、更新和删除车站信息。程序在接收到新的车站数据或修改请求时，验证车站名称、所在城市 ID 等信息的有效性。插入新车站时，生成唯一的车站 ID 并插入表中；更新车站信息时，根据车站 ID 定位到相应记录进行修改；删除车站时，确保该车站没有关联的车次等数据（若有，先处理关联数据），再从表中删除记录。
   - **车次信息查询程序**：在查询车次时，程序利用车站名称或 ID 在车站信息表中获取车站相关信息，结合车次信息表，根据出发站和到达站筛选车次。例如，用户输入出发站和到达站名称，程序先将名称转换为对应的车站 ID，再查询车次。
   - **座位信息关联程序**：在座位信息表（Seats）中关联车次和座位时，程序会根据车次经过的车站信息，确定座位的出发站和到达站等相关信息，确保座位信息与车次、车站信息的一致性。

   

4. 车次信息表（TrainNumbers）与程序的关系

   - **车次数据更新程序**：定期或在有新的车次信息时，程序从数据源获取车次编号、出发站、到达站、出发时间、到达时间等信息，更新车次信息表。插入新车次时，生成唯一的车次 ID；更新车次信息时，根据车次 ID 定位记录进行修改，确保车次信息的准确性和实时性。
   - **车次查询程序**：用户进行车次查询时，程序根据用户输入的出发时间、出发站、到达站等条件，在车次信息表中进行查询。查询时利用索引快速定位符合条件的车次记录，将查询结果返回给用户，供用户选择车次。
   - **车厢信息关联程序**：在插入或更新车厢信息时，程序根据车次 ID 在车次信息表中获取车次的出发站、到达站、出发时间、到达时间等信息，填充到车厢信息表（Carriages）中相应字段，确保车厢信息与车次信息的一致性。
   - **车票订单程序**：当用户购买车票时，程序根据用户选择的车次 ID，从车次信息表获取车次的相关信息，如出发时间、到达时间等，填充到车票订单信息记录表（tickets_orders）中，同时更新座位信息表（Seats）的座位状态和库存。

   

5. 车厢信息表（Carriages）与程序的关系

   - **车厢数据初始化程序**：在车次数据更新时，根据车次的车厢配置信息，将车厢数据插入到车厢信息表中。程序获取车厢所属车次 ID、车厢的出发站、到达站、等候时间、座位数量等信息，生成唯一的车厢 ID 并插入表中。
   - **座位信息初始化程序**：根据车厢的座位配置，程序在座位信息表中初始化座位信息。从车厢信息表获取车厢 ID、座位数量、座位类型等信息，为每个座位生成唯一的座位 ID，插入座位信息表中，并设置初始座位状态。
   - **车票预订程序**：用户预订车票时，程序根据用户选择的车次和座位，在车厢信息表中查询对应的车厢信息，获取该车厢的座位库存情况。若有可用座位，更新车厢信息表的座位库存，并在座位信息表中标记该座位为已预订状态，同时在车票订单信息记录表中插入订单记录。

   

6. 座位信息表（Seats）与程序的关系

   - **座位状态更新程序**：在车票预订、取消预订等操作时，程序根据订单状态更新座位信息表中的座位状态。预订成功时，将座位状态（flags）标记为已预订；取消预订时，将座位状态改回未预订状态，确保座位状态与实际订单情况一致。
   - **车票查询程序**：在用户查询车票时，程序根据用户选择的车次，从座位信息表中获取该车次的座位信息，包括座位类型、价格、座位状态等，展示给用户，方便用户选择座位。
   - **车票订单关联程序**：在生成车票订单时，程序将用户选择的座位 ID 关联到车票订单信息记录表（tickets_orders）中，建立车票订单与座位的对应关系，便于后续查询和管理。

   

7. 食物信息表（Food）与程序的关系

   - **食物数据更新程序**：定期或在有新的食物供应信息时，程序从供应商或内部管理系统获取食物名称、食物类型、价格、所属车次、是否为午餐或晚餐、图片 URL 等信息，更新食物信息表。插入新食物时，生成唯一的食物 ID；更新食物信息时，根据食物 ID 定位记录进行修改。
   - **火车餐预订程序**：用户预订火车餐时，程序根据用户选择的车次，从食物信息表中获取该车次的食物信息，展示给用户选择。用户选择食物后，程序在食物订单信息记录表（food_orders）中插入订单记录，并在食物订单明细（food_order_items）中记录所选食物的 ID 和数量。
   - **食物订单查询程序**：用户查询火车餐订单时，程序根据用户 ID 或订单 ID，从食物订单信息记录表和食物订单明细中获取订单信息，同时从食物信息表中获取食物的详细信息，展示给用户，方便用户查看订单详情。

   

8. 酒店信息表（Hotel）与程序的关系

   - **酒店数据维护程序**：用于插入、更新和删除酒店信息。程序接收酒店的名称、地址、评分、描述、图片 URL 等信息，验证数据的有效性后，插入或更新酒店信息表。插入新酒店时，生成唯一的酒店 ID；删除酒店时，确保该酒店没有关联的订单等数据（若有，先处理关联数据），再从表中删除记录。
   - **酒店搜索程序**：用户进行酒店搜索时，程序根据用户输入的关键词（如酒店名称、地址）或筛选条件（如评分、价格范围），在酒店信息表中进行查询。利用索引快速定位符合条件的酒店记录，将查询结果返回给用户，供用户选择酒店。
   - **酒店预订程序**：当用户预订酒店时，程序根据用户选择的酒店 ID，从酒店信息表获取酒店的相关信息，如酒店名称、地址等，填充到用户预订信息表（Reservation）和酒店订单信息记录表（hotel_orders）中。

   

9. 酒店房间信息表（Room）与程序的关系

   - **房间数据初始化程序**：在酒店数据更新时，根据酒店的房间配置信息，将房间数据插入到酒店房间信息表中。程序获取房间所属酒店 ID、房间类型、价格、房间日期、可用性等信息，生成唯一的房间 ID 并插入表中。
   - **酒店预订程序**：用户预订酒店房间时，程序根据用户选择的酒店和入住日期，在酒店房间信息表中查询符合条件的房间信息。若有可用房间，更新房间信息表的可用性状态为已预订，并在用户预订信息表和酒店订单信息记录表中插入订单记录。
   - **酒店订单查询程序**：用户查询酒店订单时，程序根据用户 ID 或订单 ID，从酒店订单信息记录表和用户预订信息表中获取订单信息，同时从酒店房间信息表中获取房间的详细信息，展示给用户，方便用户查看订单详情。

   

10. 用户预订信息表（Reservation）与程序的关系

    - **酒店预订程序**：在用户预订酒店房间时，程序生成唯一的预订 ID，将用户 ID、酒店 ID、房间 ID、入住日期、退房日期、预订状态（默认已预订）、预订时间等信息插入到用户预订信息表中，建立用户与酒店房间预订的关联。
    - **预订状态更新程序**：当用户取消预订、入住或退房等操作发生时，程序根据预订 ID 在用户预订信息表中更新预订状态。例如，取消预订时将状态改为已取消；入住时将状态改为已入住；退房时将状态改为已退房。
    - **预订查询程序**：用户查询自己的酒店预订记录时，程序根据用户 ID 在用户预订信息表中查询相关记录，结合酒店信息表和酒店房间信息表，获取酒店名称、房间类型、入住日期、退房日期等详细信息，展示给用户。

    

11. 支付信息记录表（payment_records）与程序的关系

    - **支付处理程序**：当用户进行支付操作时，程序生成唯一的支付 ID，记录订单 ID、用户 ID、支付类型、支付金额、支付方式（如微信支付、支付宝支付等）、支付状态（默认待支付）、发起支付时间等信息到支付信息记录表中。支付成功后，更新支付状态为已支付；支付失败时，更新支付状态为支付失败，并记录相关错误信息。
    - **订单状态更新程序**：根据支付状态，程序更新相应订单的状态。在车票订单、酒店订单、食物订单等模块中，当检测到支付信息记录表中的支付状态为已支付时，将对应订单的状态更新为已支付；若支付失败，根据业务逻辑处理订单，如取消订单或提示用户重新支付。
    - **支付记录查询程序**：用户或管理员查询支付记录时，程序根据用户 ID 或订单 ID 在支付信息记录表中查询相关记录，展示支付金额、支付方式、支付状态、支付时间等信息，方便用户核对支付情况和管理员进行财务统计。

    

12. 车票订单信息记录表（tickets_orders）与程序的关系

    - **车票预订程序**：用户预订车票成功后，程序生成唯一的车票订单 ID，将支付 ID、用户 ID、联系人 ID、车次 ID、座位 ID 等信息插入到车票订单信息记录表中，建立车票订单与其他相关数据的关联。
    - **车票订单查询程序**：用户查询车票订单时，程序根据用户 ID 或订单 ID 在车票订单信息记录表中查询相关记录，结合车次信息表、座位信息表等，获取车次编号、座位类型、价格、出发时间、到达时间等详细信息，展示给用户，方便用户查看车票订单详情。
    - **车票订单取消程序**：当用户取消车票订单时，程序根据订单 ID 在车票订单信息记录表中删除订单记录，同时更新座位信息表的座位状态为未预订，恢复车厢信息表的座位库存，确保数据的一致性。

    

13. 酒店订单信息记录表（hotel_orders）与程序的关系

    - **酒店预订程序**：用户预订酒店成功后，程序生成唯一的酒店订单 ID，将支付 ID、用户 ID、预订 ID 等信息插入到酒店订单信息记录表中，建立酒店订单与支付记录、用户预订信息的关联。
    - **酒店订单查询程序**：用户查询酒店订单时，程序根据用户 ID 或订单 ID 在酒店订单信息记录表中查询相关记录，结合用户预订信息表、酒店信息表、酒店房间信息表等，获取酒店名称、房间类型、入住日期、退房日期、价格等详细信息，展示给用户，方便用户查看酒店订单详情。
    - **酒店订单取消程序**：当用户取消酒店订单时，程序根据订单 ID 在酒店订单信息记录表中删除订单记录，同时更新用户预订信息表的预订状态为已取消，恢复酒店房间信息表的房间可用性，确保数据的一致性。

    

14. 食物订单信息记录表（food_orders）与程序的关系

    - **火车餐预订程序**：用户预订火车餐成功后，程序生成唯一的食物订单 ID，将支付 ID、用户 ID 等信息插入到食物订单信息记录表中，建立食物订单与支付记录、用户的关联。
    - **食物订单查询程序**：用户查询火车餐订单时，程序根据用户 ID 或订单 ID 在食物订单信息记录表中查询相关记录，结合食物订单明细、食物信息表等，获取食物名称、食物类型、价格、数量等详细信息，展示给用户，方便用户查看食物订单详情。
    - **食物订单取消程序**：当用户取消食物订单时，程序根据订单 ID 在食物订单信息记录表中删除订单记录，同时根据业务逻辑处理食物库存（若有库存管理），确保数据的一致性。

    

15. 消息记录表（notifications）与程序的关系

    - **消息发送程序**：当系统发生重要事件，如订单状态变更、系统公告发布等，程序生成唯一的消息 ID，记录用户 ID、订单 ID（若相关）、消息类型、消息内容、发送渠道（默认站内信）、发送状态（默认待发送）、创建时间等信息到消息记录表中。同时，根据发送渠道（如短信、邮件、站内信）调用相应的发送接口，将消息发送给用户，并更新发送状态和发送时间。
    - **消息查询程序**：用户登录系统后，程序根据用户 ID 在消息记录表中查询该用户的未读消息和历史消息，展示给用户。用户查看消息后，程序更新消息的已读状态为已读。
    - **消息管理程序**：管理员可通过消息管理程序在消息记录表中查询、删除或修改消息内容（在一定权限范围内）。例如，删除过期的系统公告消息，修改错误的订单通知消息等，确保消息的准确性和有效性。



## 4 系统数据库设计

## 5 运行设计

### 5.1运行模块组合

### 5.2运行控制

### 5.3运行时间







