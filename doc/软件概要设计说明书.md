# 软件概要设计说明书

>1. 《软件概要设计说明书》(SDD)概要设计说明书又可称系统设计说明书，这里所说的系统是指程序系统。编制的目的是说明对程序 系统的设计考虑，包括程序系统的基本处理流程、程序系统的组织结构、模块划分、功能分配、接口设计、运行设计、安全设计、数据结构设计和出错处理设计等，为程序的详细设计提供基础。
>2. 本课程及本实验不涉及、不强调、不关注的部分可省略，但不允许删除已有条目。
>3. 最终文档请删除所有灰色字体和斜体等说明部分。

[Toc]

## 1 引言

### 1.1 编写目的

*说明编写这份概要设计说明书的目的，指出预期的读者。*

### 1.2 背景

*说明：*

*a．待开发软件系统的名称；*

*b．列出此项目的任务提出者、开发者、用户以及将运行该软件的计算站（中心）。*

### 1.3 定义

*列出本文件中用到的专门术语的定义和外文首字母组词的原词组。*

### 1.4参考设计

*列出有关的参考文件*

## 2 系统需求概述

### 2.1需求规定

*说明对本系统的主要的输入输出项目、处理的功能性能要求*

### 2.2业务目标

### 2.3运行环境

*简要地说明对本系统的运行环境（包括硬件环境和支持环境）的规定*

#### 2.3.1设备 

*列出运行该软件所需要的硬设备。说明其中的新型设备及其专门功能。*

#### 2.3.2支持软件

*列出支持软件，包括要用到的操作系统、编译（或汇编）程序、测试支持软件等。*

### 2.4设计约束

### 2.5功能需求

*说明本系统的基本设计概念和处理流程，尽量使用图表的形式。*

### 2.6非功能需求

### 2.7系统总体架构

*用UML图和相应的文字介绍说明本系统的整体架构*

## 3 系统接口设计

### 3.2接口设计

#### 3.2.1用户接口

在本系统中，用户接口的设计不仅考虑到功能的全面性，还注重用户操作的流畅性与界面友好性。具体而言，以下为扩展后的模块设计：

##### 1. 购票模块：
- **查询界面**：
  - 用户可以按不同的过滤条件选择车次，除了基本的出发城市、到达城市、出发日期外，还可以筛选出发时间、车厢类型等高级条件。
  - 查询结果支持按时间、价格、到达时间等排序，并且支持批量查询，显示多日的车次信息。
  - 系统会自动提醒用户当前车次的热门程度和剩余票量，帮助用户做出更好的决策。
  
- **车次选择**：
  - 用户可以在车次选择界面查看每个车次的详细信息，包括出发站、到达站、预计发车时间、到达时间、停站情况等。
  - 支持列出历史同线路的乘车记录，便于用户快速选择合适的车次。

- **座位选择**：
  - 座位选择界面可以显示不同车厢的座位布局，包括商务座、一等座、二等座、软卧、硬卧等。
  - 用户可以直接点击座位进行选择，并实时显示座位的价格信息，系统提供座位的可选状态（如“已售出”或“已预订”）。

- **支付界面**：
  - 系统会根据用户选择的支付方式，提供相应的支付接口（如微信支付、支付宝支付、银行卡支付等）。
  - 用户在支付过程中，如果支付失败，系统会自动提供重新支付的机会，并提供客服联系方式。

- **订单管理**：
  - 用户可以在订单管理页面查看当前和历史订单的状态，并可对未付款的订单进行修改、取消操作。
  - 系统自动同步订单状态（如“支付成功”、“已发车”等），并提供实时的订单信息更新。

##### 2. 酒店预订模块：
- **搜索界面**：
  - 用户可以根据目的地、日期、价格、星级、酒店品牌等多重条件进行搜索。
  - 系统会智能推荐目的地附近的热门景点或餐饮商家，帮助用户更好地选择酒店。

- **酒店详情**：
  - 除了常规的酒店信息展示外，还会显示酒店内的设施、周边交通和景点，以及其他用户的评价。
  - 系统会通过图文并茂的形式展示酒店的房型、床型、装修风格等，提升用户选择的信心。

- **房间预订**：
  - 用户可以根据需要选择是否加入额外服务，如早餐、机场接送等，并在预订页面进行确认。
  - 预订流程简化为三步：选择日期、选择房型、填写入住人信息，提升用户操作效率。

- **订单管理**：
  - 系统不仅显示历史订单，还允许用户在入住前直接进行修改，如更改入住日期、房型，或取消预订。
  - 对于酒店订单的变动，系统会提供实时的消息推送和短信通知。

##### 3. 火车餐购买模块：
- **餐品选择**：
  - 系统展示可选餐品的详细菜单和营养成分，让用户可以根据个人口味和饮食需求选择餐品。
  - 用户可以选择单独餐品，也可以选择套餐，套餐中包含多个不同的餐品，满足不同用户需求。

- **订餐确认**：
  - 在确认订餐后，用户可以直接进入支付界面，通过支付宝、微信等多种方式支付餐费。
  - 支付后，用户可以看到餐品的配送进度，并接收关于餐品配送的实时更新通知。

##### 4. 消息通知模块：
- **系统通知**：
  - 系统将通过多渠道（短信、推送通知、邮件等）向用户推送操作确认、票务状态、酒店预订信息等。
  - 除了系统自动发送通知外，用户还可以自定义接收的通知类型与渠道，以便更加个性化的服务体验。

#### 3.2.2 与其他软件、硬件接口
本系统还需要与多个外部系统及硬件进行接口对接，确保系统功能全面且高效。以下为扩展后的接口设计内容：

##### 1. 与外部支付系统接口：
- **支付请求接口**：
  - 系统会向支付平台发送订单信息，包括订单编号、支付金额、用户信息等，并提供支付方式选择。
  - 系统需要支持多种支付方式的无缝切换，用户可在一个界面选择支付方式进行支付。

- **支付结果回调接口**：
  - 支付平台返回支付结果后，系统需要根据支付成功与否更新订单状态，并同步通知用户。
  - 在支付失败的情况下，系统会提供重试机制，并确保支付状态的准确性。

##### 2. 与外部信息服务接口：
- **车次查询接口**：
  - 系统会定期从火车时刻查询平台同步数据，确保车次信息准确无误。
  - 支持批量查询多日车次信息，并根据用户需求进行筛选和推荐。

- **票务查询接口**：
  - 票务查询接口支持实时查询余票信息，当用户选择的车次没有足够的票时，系统会提示用户其他可选车次。

##### 3. 与外部短信/邮件服务接口：
- **短信发送接口**：
  - 系统将与短信平台对接，确保用户在完成购票、预定、支付等操作后及时收到通知。
  - 短信内容支持个性化定制，如定制用户名、订单编号等信息，提高通知的有效性。

- **邮件发送接口**：
  - 系统通过邮件平台自动发送订单确认、退改签等通知邮件。
  - 邮件内容除了订单详细信息外，还会附带相关的用户操作指引或客服联系方式。

##### 4. 与酒店预订平台接口：
- **酒店信息查询接口**：
  - 系统支持向外部酒店预订平台查询实时酒店价格、房型以及可用性。
  - 系统会将获取到的酒店信息展示给用户，并支持用户进行在线预订。

- **预订接口**：
  - 系统会提交用户的预订请求，包含入住日期、退房日期、用户信息等，完成酒店的在线预订。

##### 5. 与外部物流系统接口：
- **物流信息接口**：
  - 若系统提供餐饮配送等服务，物流接口将负责配送订单的生成、追踪与状态更新。
  - 配送信息将实时同步给用户，包括预计配送时间、配送状态等，确保用户了解物流情况。

### 3.3 系统数据结构设计

#### 3.3.1 逻辑结构设计要点

*给出本系统内所使用的每个数据结构的名称、标识符以及它们之中每个数据项、记录、文卷和系的标识、定义、长度及它们之间的层次的或表格的相互关系。*

#### 3.3.2 物理结构设计要点

*给出本系统内所使用的每个数据结构中的每个数据项的存储要求，访问方法、存取单位、存取的物理关系（索引、设备、存储区域）、设计考虑和保密条件。*

#### 3.3.3数据结构与程序关系



## 4 系统数据库设计

本系统数据库采用 MySQL，数据类型设计兼顾了性能与扩展性，统一采用 BINARY(16) 存储主键，便于高并发、分布式下的主键管理。整体设计围绕用户购票、酒店预订、订餐及支付通知等核心业务展开，具有良好的可扩展性与一致性保障。

### 4.1 数据库总体设计
数据库名称：`swift_travel`

存储引擎：InnoDB

字符集：utf8mb4

主键设计：统一采用 UUID（BINARY(16) 压缩存储）

字段命名规范：小写字母+下划线，具有业务含义

逻辑删除字段：所有表均设置 `del TINYINT(1)` 字段标记逻辑删除

时间戳字段：重要表设置 `created_at`、`updated_time` 等记录操作时间

### 4.2 数据表设计

#### 4.2.1 用户表

用于存储系统用户的基本信息。

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id        | BINARY(16)   | 主键，用户ID    |
| username  | VARCHAR(50)  | 用户名，唯一    |
| password  | VARCHAR(255) | 密码（加密存储） |
| id_card   | VARCHAR(20)  | 身份证号        |
| phone     | VARCHAR(20)  | 手机号          |
| email     | VARCHAR(100) | 电子邮箱，唯一  |
| created_at| TIMESTAMP    | 注册时间        |
| del       | TINYINT(1)   | 删除标记（逻辑删除） |

#### 4.2.2 联系人表

记录用户常用联系人信息。

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| contact_id| BINARY(16)   | 主键，联系人ID |
| user_id   | BINARY(16)   | 所属用户ID     |
| contact_name | VARCHAR(100) | 联系人姓名 |
| contact_phone| VARCHAR(20) | 联系人电话 |
| contact_email| VARCHAR(100) | 联系人邮箱 |
| created_at| TIMESTAMP    | 创建时间        |
| del       | TINYINT(1)   | 删除标记 |

#### 4.2.3 城市与车站表

**城市表（City）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id        | BINARY(16)   | 主键，城市ID   |
| city_name | VARCHAR(50)  | 城市名称       |
| del       | TINYINT(1)   | 删除标记       |

**车站表（Station）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id        | BINARY(16)   | 主键，车站ID   |
| station_name | VARCHAR(50) | 车站名称    |
| city_id   | BINARY(16)   | 所属城市ID     |
| del       | TINYINT(1)   | 删除标记       |

#### 4.2.4 车次及座位相关表

**车次表（TrainNumbers）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id        | BINARY(16)   | 主键，车次ID   |
| train_number | VARCHAR(10) | 车次编号    |
| dep_station  | VARCHAR(50) | 出发站      |
| dep_city     | VARCHAR(50) | 出发城市    |
| arr_station  | VARCHAR(50) | 到达站      |
| arr_city     | VARCHAR(50) | 到达城市    |
| dep_time     | DATETIME    | 出发时间    |
| arr_time     | DATETIME    | 到达时间    |
| del          | TINYINT(1)  | 删除标记    |

**车厢表（Carriages）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id        | BINARY(16)   | 主键，车厢ID   |
| train_number | BINARY(16) | 关联车次ID   |
| dep_station | VARCHAR(50) | 出发站       |
| dep_city    | VARCHAR(50) | 出发城市     |
| arr_station | VARCHAR(50) | 到达站       |
| arr_city    | VARCHAR(50) | 到达城市     |
| arr_time    | DATETIME    | 到达时间     |
| wait_time   | TIME        | 等待时间     |
| all_number  | INT         | 总座位数     |
| first_number| INT         | 一等座数     |
| second_number| INT        | 二等座数     |
| business_number| INT      | 商务座数     |
| no_seat_number| INT       | 无座数量     |
| del         | TINYINT(1)  | 删除标记     |

**座位表（Seats）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id        | BINARY(16)   | 主键，座位ID   |
| train_number | BINARY(16) | 所属车次ID   |
| coach     | INT          | 车厢号         |
| seat_type | VARCHAR(10)  | 座位类型       |
| price     | DECIMAL(10,2)| 价格           |
| flags     | BINARY(8)    | 座位状态       |
| version   | INT          | 乐观锁版本号   |
| del       | TINYINT(1)   | 删除标记       |

#### 4.2.5 酒店预订相关表

**酒店表（Hotel）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id        | BINARY(16)   | 主键，酒店ID   |
| name      | VARCHAR(50)  | 酒店名称       |
| address   | VARCHAR(50)  | 酒店地址       |
| rating    | DECIMAL(2,1) | 酒店评分       |
| description | VARCHAR(255) | 描述       |
| pic_url   | VARCHAR(255) | 图片URL        |
| del       | TINYINT(1)   | 删除标记       |

**房间表（Room）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id        | BINARY(16)   | 主键，房间ID   |
| hotel_id  | BINARY(16)   | 所属酒店ID     |
| room_type | VARCHAR(50)  | 房间类型       |
| price     | DECIMAL(10,2)| 房价           |
| room_date | DATE         | 房间日期       |
| availability | BOOLEAN   | 可用性         |
| del       | TINYINT(1)   | 删除标记       |

**预订表（Reservation）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id            | BINARY(16) | 主键，预订ID |
| user_id       | BINARY(16) | 用户ID        |
| hotel_id      | BINARY(16) | 酒店ID        |
| room_id       | BINARY(16) | 房间ID        |
| checkin_date  | DATE       | 入住日期      |
| checkout_date | DATE       | 离店日期      |
| status        | VARCHAR(50)| 预订状态      |
| booking_time  | TIMESTAMP  | 预订时间      |
| del           | TINYINT(1) | 删除标记      |

#### 4.2.6 食物相关表

**食品表（Food）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id        | BINARY(16)   | 主键，食品ID   |
| trains_id | BINARY(16)   | 所属车次ID     |
| food_name | VARCHAR(50)  | 食品名称       |
| food_type | VARCHAR(10)  | 食品类型       |
| price     | DECIMAL(10,2)| 价格           |
| lunch     | BOOLEAN      | 是否午餐       |
| dinner    | BOOLEAN      | 是否晚餐       |
| pic_url   | VARCHAR(255) | 图片URL        |
| del       | TINYINT(1)   | 删除标记       |

**食物订单及明细表（food_orders & food_order_items）**

- `food_orders`：存储食物订单基本信息
- `food_order_items`：存储每个订单中的食品项明细

#### 4.2.7 订单与支付相关表

**火车票订单表（tickets_orders）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| id        | BINARY(16)   | 主键，订单ID   |
| pay_id    | BINARY(16)   | 支付ID         |
| user_id   | BINARY(16)   | 用户ID         |
| contacts_id | BINARY(16) | 联系人ID       |
| train_id  | BINARY(16)   | 车次ID         |
| seat_id   | BINARY(16)   | 座位ID         |
| del       | TINYINT(1)   | 删除标记       |

**酒店订单表（hotel_orders）**

| 字段名        | 类型          | 描述                  |
|---------------|---------------|-----------------------|
| id            | BINARY(16)     | 主键，订单ID          |
| pay_id        | BINARY(16)     | 支付ID                |
| user_id       | BINARY(16)     | 用户ID                |
| hotel_id      | BINARY(16)     | 酒店ID                |
| room_id       | BINARY(16)     | 房间ID                |
| checkin_date  | DATE           | 入住日期              |
| checkout_date | DATE           | 离店日期              |
| total_amount  | DECIMAL(10,2)  | 总价格                |
| order_time    | TIMESTAMP      | 下单时间              |
| status        | VARCHAR(20)    | 订单状态（如已预订、已取消） |
| del           | TINYINT(1)     | 删除标记              |

**食品订单表（food_orders）**

| 字段名        | 类型          | 描述                  |
|---------------|---------------|-----------------------|
| id            | BINARY(16)     | 主键，订单ID          |
| pay_id        | BINARY(16)     | 支付ID                |
| user_id       | BINARY(16)     | 用户ID                |
| food_total    | DECIMAL(10,2)  | 食品总金额            |
| train_id      | BINARY(16)     | 关联车次ID            |
| carriage_id   | BINARY(16)     | 关联车厢ID            |
| seat_id       | BINARY(16)     | 关联座位ID            |
| order_time    | TIMESTAMP      | 下单时间              |
| status        | VARCHAR(20)    | 订单状态（如已支付、已取消） |
| del           | TINYINT(1)     | 删除标记              |


**支付记录表（payment_records）**

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| payment_id | BINARY(16)  | 主键，支付ID    |
| order_id   | BINARY(16)  | 关联订单ID      |
| user_id    | BINARY(16)  | 支付用户ID      |
| pay_type   | VARCHAR(20) | 购买对象类型    |
| amount     | DECIMAL(10,2)| 支付金额        |
| method     | VARCHAR(20) | 支付方式        |
| status     | VARCHAR(20) | 支付状态        |
| created_time | DATETIME  | 创建时间        |
| updated_time | DATETIME  | 更新时间        |
| del        | TINYINT(1)  | 删除标记        |

#### 4.2.8 消息通知表

用于系统通知消息管理。

| 字段名    | 类型        | 描述           |
|-----------|-------------|----------------|
| message_id| BINARY(16)   | 主键，消息ID   |
| user_id   | BINARY(16)   | 接收用户ID     |
| order_id  | BINARY(16)   | 关联订单ID（可空） |
| message_type | VARCHAR(20)| 消息类型      |
| content   | TEXT         | 消息内容       |
| channel   | VARCHAR(20)  | 发送渠道       |
| is_read   | BOOLEAN      | 是否已读       |
| send_status| VARCHAR(20) | 发送状态       |
| send_time | DATETIME     | 发送时间       |
| created_time| DATETIME   | 创建时间       |
| del       | TINYINT(1)   | 删除标记       |

### 4.3 数据库设计特点总结

- 采用 **UUID（BINARY(16)）** 作为主键，确保分布式场景下的数据唯一性与安全性；

- 所有表统一设置 `del` 字段，实现逻辑删除，保障数据可恢复性；

- 充分细化订单系统（票务、酒店、餐食），便于扩展和统一管理；

- 明确支付状态与消息通知流程，强化了系统的事务一致性设计；

- 预留了优化索引的空间，支持未来高并发访问和复杂查询。


## 5 运行设计

### 5.1运行模块组合

### 5.2运行控制

### 5.3运行时间







