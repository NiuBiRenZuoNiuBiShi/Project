# 软件详细设计说明书

[TOC]

## 1 引言

### 1.1 编写目的
本详细设计说明书旨在描述"风行旅途"在线火车购票旅游系统的详细设计方案，包括系统架构、模块划分、数据结构、接口设计等内容。本文档主要面向系统开发团队、测试团队和项目管理人员，为系统的开发、测试和维护提供技术指导和规范。同时，本文档也将作为系统验收和后期维护的依据。

### 1.2 背景

#### a. 待开发软件系统名称
"风行旅途"在线火车购票旅游系统

#### b. 项目相关方
- **任务提出者**：国家铁路集团客运部门
- **开发者**：风行科技有限公司技术研发团队
- **用户**：
  - 普通旅客（个人用户）
  - 企业客户（团体预订）
  - 系统管理员
  - 客服人员
  - 合作商家（酒店、餐饮服务提供商）
- **运行环境**：
  - 阿里云/腾讯云分布式云计算中心
  - 国家铁路数据中心
  - 移动应用商店及Web浏览器

### 1.3 术语表

| 术语 | 定义 |
|------|------|
| API | Application Programming Interface，应用程序编程接口 |
| SaaS | Software as a Service，软件即服务 |
| RESTful | Representational State Transfer，一种软件架构风格 |
| JWT | JSON Web Token，用于安全传输信息的开放标准 |
| MVC | Model-View-Controller，模型-视图-控制器，一种软件设计模式 |
| ORM | Object-Relational Mapping，对象关系映射 |
| CDN | Content Delivery Network，内容分发网络 |
| SDK | Software Development Kit，软件开发工具包 |
| SLA | Service Level Agreement，服务级别协议 |
| 微服务 | 一种将应用程序构建为独立组件集合的架构风格 |
| 负载均衡 | 将工作负载分布到多个计算资源的技术 |
| 分布式事务 | 跨越多个资源的事务处理 |
| 冷热数据分离 | 根据数据访问频率进行分类存储的策略 |
| 幂等性 | 操作任意多次与一次效果相同的特性 |
| 分布式锁 | 控制分布式系统中对共享资源并发访问的机制 |

### 1.4 参考文档

1. 《"风行旅途"在线火车购票旅游系统需求规格说明书》v1.2，2024年3月
2. 《"风行旅途"在线火车购票旅游系统概要设计说明书》v1.0，2024年4月
3. 《国家铁路旅客服务系统接口规范》v3.5，2023年12月
4. 《酒店预订系统数据交换标准》v2.0，2024年1月
5. 《支付系统安全规范》v4.0，2023年10月
6. 《铁路旅客服务质量标准》GB/T XXXXX-2023
7. 《移动互联网应用程序（APP）个人信息保护测评规范》v2.0，2023年
8. 《信息安全技术 个人信息安全规范》GB/T 35273-2023
9. 《软件工程 软件质量保证》GB/T 12504-2022
10. 《分布式系统可靠性设计指南》，2024年版
11. 《高并发系统设计原则》，2023年版
12. 《互联网应用无障碍设计规范》，2023年版


## 2 系统结构设计及子系统划分

## 2.1 系统总体架构

整个"风行旅途"系统划分为以下子系统：

1. 用户管理子系统
2. 火车购票子系统
3. 酒店预订子系统
4. 火车订餐子系统
5. 支付结算子系统
6. 消息通知子系统
7. 评价反馈子系统
8. 系统管理子系统

各子系统之间的关系如下：
![alt text](组件图.png)

### 2.2 火车购票子系统
### 2.2.1 功能概述

火车购票子系统负责提供列车信息查询、车票预订、订单管理、退改签等功能，是"风行旅途"平台的核心子系统之一。

### 2.2.2 模块划分

1. **车次查询模块**：提供根据出发地、目的地、出发日期等条件查询列车信息的功能。
2. **座位查询模块**：查询指定车次的座位余票情况。
3. **车票预订模块**：完成车票预订的核心流程，包括乘客信息录入、座位选择等。
4. **订单管理模块**：管理用户的车票订单，包括订单查询、订单详情等。
5. **退改签模块**：处理用户的退票和改签请求。
6. **常用联系人模块**：管理用户常用乘车人信息。

### 2.2.3 活动图 - 火车票预订流程
![alt text](订票活动图.png)

### 2.2.4 顺序图 - 车票预订过程
![alt text](火车顺序图.png)

## 2.3 火车订餐子系统
### 2.3.1 功能概述
火车订餐子系统负责提供列车餐食预订服务，允许用户在乘车前或乘车过程中选择并预订餐食，提升旅行体验。

### 2.3.2 模块划分
1. 餐食信息模块：提供列车可用餐食信息查询。
2. 餐食预订模块：处理用户的餐食预订请求。
3. 订单管理模块：管理用户的餐食订单。
4. 餐食评价模块：收集和管理用户对餐食的评价。
5. 餐食推荐模块：根据用户偏好和历史订单推荐餐食

### 2.3.3 活动图 - 火车订餐流程
![alt text](订餐活动图.png)

### 2.3.4 顺序图 - 火车订餐过程
![alt text](订餐顺序图.png)

### 2.4 子系统间接口设计

#### 2.4.1 火车购票子系统与其他子系统的接口

1. **与用户管理子系统的接口**
   - 获取用户基本信息
   - 验证用户身份信息
   - 获取常用联系人列表

2. **与支付结算子系统的接口**
   - 创建支付订单
   - 获取支付结果
   - 申请退款

3. **与消息通知子系统的接口**
   - 发送订票成功通知
   - 发送出行提醒
   - 发送退改签结果通知

4. **与火车订餐子系统的接口**
   - 提供车票信息
   - 检验乘车人身份

#### 2.4.2 火车订餐子系统与其他子系统的接口

1. **与火车购票子系统的接口**
   - 获取车票信息
   - 验证乘车人身份

2. **与支付结算子系统的接口**
   - 创建餐食支付订单
   - 获取支付结果
   - 申请退款

3. **与消息通知子系统的接口**
   - 发送订餐成功通知
   - 发送取餐提醒
   - 发送餐食评价提醒

4. **与评价反馈子系统的接口**
   - 提交餐食评价
   - 获取餐食评分

## 3 功能模块设计

*详细设计系统中的各个模块。包括模块功能描述、输入输出定义、算法设计等。每个模块的设计应该遵循高内聚、低耦合的原则，保证模块的独立性和可维护性。*

*每个模块的描述说明需要包括以下内容：*

*模块编号、模块名称、输入、处理、算法描述、输出*



## 4 界面设计

*如果系统包含用户界面，需要提供界面设计。包括界面布局、控件和交互方式等*

### 4.1 外部界面设计

*根据系统页面划分进行系统外部界面设计，对系统的所有外部接口（包括功能和数据接口）进行设计。*

### 4.2 内部界面设计

*设计系统内部各功能模块间的调用关系和数据接口。*

### 4.3 用户界面设计

*规定人机界面的内容、界面风格、调用方式等，包括表单设计、用户需要的打印输出等设计。*



## 5 异常处理设计

本节描述系统运行过程中可能出现的异常情况，包括输入错误、服务中断、支付失败等问题，并提出相应的错误提示策略、预防机制以及维护方案，确保系统具备良好的健壮性和用户体验。

### 5.1 出错信息管理
系统需对不同模块中的异常情况进行统一管理与处理，并向用户或运维人员提供清晰、可操作的错误提示信息。出错信息应具备唯一编号、清晰描述和可能的解决方案建议。

| 模块         | 异常场景             | 错误码 | 错误信息（面向用户）        | 系统日志记录                     | 处理策略                           |
|--------------|----------------------|--------|------------------------------|----------------------------------|------------------------------------|
| 火车票购买   | 查询不到余票         | T001   | 当前车次无余票               | [WARN] 无票信息                 | 提示用户换车次或日期              |
| 火车票购买   | 支付失败             | T002   | 支付未成功，请重试           | [ERROR] 支付接口失败，订单号X   | 回滚订单状态，支持重新支付        |
| 酒店预订     | 酒店已满房           | H001   | 所选酒店无可预订房间         | [WARN] 房态已变更               | 建议用户选择其他酒店              |
| 餐食购买     | 商品售罄             | M001   | 餐品已售罄                   | [INFO] 商品库存为0              | 屏蔽该商品显示，建议更换          |
| 消息通知     | 通知接口超时         | N001   | -（后台异常，无用户提示）    | [ERROR] 短信接口超时            | 自动重试并告警                    |
| 用户账户     | 登录失败（密码错误） | U001   | 账号或密码错误               | [INFO] 登录失败尝试             | 限制错误次数，提示找回密码        |

### 5.2故障预防与补救

为了最大限度减少系统异常对业务流程的影响，系统设计中引入了以下预防与补救机制：

- **接口熔断与重试机制**

    对接外部系统（如支付、通知、酒店）时，设置超时限制、重试次数，若连续失败自动熔断，避免拖慢系统主线程。

- **服务降级机制**

    某些非核心模块（如餐食推荐、历史记录）在依赖异常时可临时关闭，主流程不受影响。

- **缓存与本地兜底数据**

    使用缓存存储热门数据，如热门车次、常用车站等，防止因后台服务不可用造成查询失败。

- **订单幂等性设计**

    火车票、餐食、酒店等下单流程均支持幂等处理，避免因网络抖动、重复请求造成多次扣款或重复订单。

- **支付失败回滚机制**

    若支付未完成，系统将自动释放占用资源（座位、房间、库存）并通知用户，避免资源锁死。

- **错误日志与告警系统**

    后端部署统一日志收集与监控机制（如 ELK + Prometheus + AlertManager），对异常进行实时告警、定位与追踪。

### 5.3 系统维护设计

为了支持系统长期稳定运行，系统在设计时考虑了以下维护机制：

- **日志管理：**
所有服务按模块记录访问日志与错误日志，日志文件按时间轮转，支持关键字检索与日志级别过滤（INFO/WARN/ERROR）。

- **异常监控与报：**
引入统一的监控平台，实时跟踪服务状态（如 CPU、内存、响应时间、错误率等），发现异常及时通知运维人员。

- **自动化部署与回滚：**
支持 CI/CD 自动部署，并配置蓝绿部署、回滚机制，确保系统升级可控、安全。

- **数据库健康检测：**
定期检测数据库连接状态、慢查询日志、磁盘空间，自动告警异常情况。

- **接口测试与模拟：**
提供完整的接口测试用例和测试环境，关键业务流程设有接口模拟器（Mock Server）防止联调时中断主系统。

## 6 性能优化和安全设计

*针对系统的性能和安全性进行优化和设计，包括数据存储、传输和访问的安全性考虑。*



## 7 项目测试计划

*描述对系统进行测试的策略和方法。包括单元测试、集成测试和系统测试等。*

| 序号 | 测试类型 | 对应部分 | 测试内容 | 计划测试时间 |
| ---- | -------- | -------- | -------- | ------------ |
|      |          |          |          |              |
